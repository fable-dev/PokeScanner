<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoGo Smart Scanner</title>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; }
        h1 { text-align: center; color: #333; }
        
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* Upload Button */
        .btn-upload { 
            background-color: #3b82f6; color: white; padding: 12px; 
            border-radius: 8px; cursor: pointer; display: block; 
            text-align: center; margin-bottom: 20px; font-weight: bold;
        }
        input[type="file"] { display: none; }
        
        /* Preview Image */
        #preview-image { max-width: 100%; border-radius: 8px; display: none; margin-bottom: 20px; }
        
        /* Results Grid */
        .result-group { margin-bottom: 15px; }
        .result-group label { display: block; font-size: 0.9em; color: #666; margin-bottom: 5px; }
        .result-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1.1em; box-sizing: border-box; }
        
        /* Status Bar */
        #status { text-align: center; margin-bottom: 20px; font-weight: bold; color: #555; height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ“¸ Smart Scanner</h1>
    
    <label for="uploader" class="btn-upload">Tap to Upload Screenshot</label>
    <input type="file" id="uploader" accept="image/*">
    
    <div id="status"></div>
    <img id="preview-image" />

    <div class="result-group">
        <label>PokÃ©mon Name (Guess)</label>
        <input type="text" id="p-name" placeholder="e.g. Charizard">
    </div>
    <div class="result-group">
        <label>CP</label>
        <input type="number" id="p-cp" placeholder="e.g. 2500">
    </div>
    <div class="result-group">
        <label>HP (Max)</label>
        <input type="number" id="p-hp" placeholder="e.g. 150">
    </div>
    <div class="result-group">
        <label>Power Up Cost (Stardust)</label>
        <input type="number" id="p-dust" placeholder="e.g. 2500">
    </div>
     <div class="result-group">
        <label>Potential Moves (Raw Text)</label>
        <input type="text" id="p-moves" placeholder="Detected moves...">
    </div>
</div>

<script>
    const uploader = document.getElementById('uploader');
    const preview = document.getElementById('preview-image');
    const status = document.getElementById('status');

    // UI Elements
    const fieldName = document.getElementById('p-name');
    const fieldCP = document.getElementById('p-cp');
    const fieldHP = document.getElementById('p-hp');
    const fieldDust = document.getElementById('p-dust');
    const fieldMoves = document.getElementById('p-moves');

    uploader.addEventListener('change', () => {
        const file = uploader.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
            preview.src = reader.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);

        status.innerText = "Processing Image...";
        
        // Reset fields
        fieldName.value = ''; fieldCP.value = ''; fieldHP.value = ''; fieldDust.value = ''; fieldMoves.value = '';

        Tesseract.recognize(
            file,
            'eng',
            { logger: m => { if (m.status === 'recognizing text') status.innerText = `Scanning: ${Math.round(m.progress * 100)}%`; } }
        ).then(({ data: { text, lines } }) => {
            status.innerText = "Scan Complete!";
            parseData(text, lines);
        });
    });

    function parseData(fullText, lines) {
        // 1. Find CP (Pattern: CP followed by numbers)
        // matches "CP 2500" or "CP2500"
        const cpMatch = fullText.match(/CP\s*(\d+)/i);
        if (cpMatch) fieldCP.value = cpMatch[1];

        // 2. Find HP (Pattern: number / number)
        // matches "120/120" or "HP 120/120"
        const hpMatch = fullText.match(/(\d+)\s*\/\s*(\d+)/);
        if (hpMatch) fieldHP.value = hpMatch[2]; // usually we want the Max HP (the second number)

        // 3. Find Stardust Cost (Harder)
        // We look for the "Power Up" line and try to find a number on it
        // Or we look for a standalone number like "2,500" or "2500" that appears after "Power Up"
        const dustRegex = /Power\s*Up[\s\S]{0,15}?(\d{1,2}[,\.]?\d{3}|\d{3,4})/; 
        const dustMatch = fullText.match(dustRegex);
        if (dustMatch) {
            // Remove commas/dots to get pure integer
            fieldDust.value = dustMatch[1].replace(/[,\.]/g, '');
        }

        // 4. Guess the Name
        // Heuristic: The name is usually the text line immediately AFTER the CP line
        // or immediately BEFORE the HP line. 
        lines.forEach((line, index) => {
            // If this line contains the CP we found...
            if (cpMatch && line.text.includes(cpMatch[0])) {
                // The name is often the NEXT line that isn't empty
                if (lines[index + 1]) {
                    // Simple cleanup of name text
                    let nameCandidate = lines[index + 1].text.trim();
                    // If the next line is "HP", then the name might actually be ABOVE the CP
                    if (!nameCandidate.includes('HP')) {
                        fieldName.value = nameCandidate;
                    }
                }
            }
        });

        // 5. Guess Moves (Very rudimentary)
        // Moves often have damage numbers (e.g., "5", "110", "50") at the end of the line.
        // We filter for lines that end in 1-3 digits but ARE NOT the CP or HP lines.
        let potentialMoves = [];
        lines.forEach(line => {
            const t = line.text.trim();
            // Ends in a number? (e.g. "Water Gun 5")
            if (/\s\d{1,3}$/.test(t)) {
                // Exclude CP/HP/Stardust lines
                if (!t.includes('CP') && !t.includes('/') && !t.includes('Power Up')) {
                    potentialMoves.push(t);
                }
            }
        });
        fieldMoves.value = potentialMoves.join(", ");
    }
</script>

</body>
</html>
